<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vietnamese Stock News Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#1E40AF',
                        dark: '#1F2937',
                        light: '#F8FAFC'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 font-sans">
    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-100">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <h1 class="text-xl font-bold text-gray-900">Vietnamese Stock News Dashboard</h1>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-500">Real-time Market Intelligence</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- News Page -->
            <div id="newsPage" class="page-content">
                <!-- VNINDEX Chart Section -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h3 class="text-xl font-bold text-dark flex items-center">
                                <i class="fas fa-chart-area text-primary mr-3"></i>
                                VN-Index Performance
                            </h3>
                            <p class="text-gray-500 mt-1">Vietnam's benchmark stock index</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button class="vnindex-period-btn px-4 py-2 text-sm font-medium rounded-lg bg-primary text-white" data-period="1M">1M</button>
                            <button class="vnindex-period-btn px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-100" data-period="3M">3M</button>
                            <button class="vnindex-period-btn px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-100" data-period="6M">6M</button>
                            <button class="vnindex-period-btn px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-100" data-period="1Y">1Y</button>
                        </div>
                    </div>
                    
                    <!-- Price Display -->
                    <div class="mb-4 p-4 bg-gray-50 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Current Value</p>
                                <p class="text-2xl font-bold text-dark" id="vnindexPrice">-</p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm text-gray-500">Change</p>
                                <div id="vnindexChange" class="text-lg font-semibold">
                                    <span class="text-gray-400">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="relative h-80">
                        <canvas id="vnindexChart" class="w-full h-full"></canvas>
                        <div id="vnindexLoading" class="absolute inset-0 flex items-center justify-center">
                            <div class="text-center">
                                <i class="fas fa-spinner fa-spin text-2xl text-primary mb-2"></i>
                                <p class="text-gray-500">Loading VN-Index data...</p>
                            </div>
                        </div>
                        <div id="vnindexError" class="absolute inset-0 flex items-center justify-center hidden">
                            <div class="text-center">
                                <i class="fas fa-exclamation-triangle text-2xl text-red-500 mb-2"></i>
                                <p class="text-gray-500">Unable to load VN-Index data</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Stock Activity -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h3 class="text-xl font-bold text-dark flex items-center">
                                <i class="fas fa-fire text-red-500 mr-3"></i>
                                Trending Stocks
                            </h3>
                            <p class="text-gray-500 mt-1">Most mentioned stocks in recent news</p>
                        </div>
                        <div class="flex items-center space-x-4">
                            <label for="dashboardDays" class="text-sm font-medium text-gray-700">Period:</label>
                            <select id="dashboardDays" class="border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="1">1 day</option>
                                <option value="3" selected>3 days</option>
                                <option value="7">7 days</option>
                                <option value="14">14 days</option>
                            </select>
                            <button id="refreshStocksBtn" class="bg-primary hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors text-sm font-medium">
                                <i class="fas fa-sync-alt mr-2"></i>Refresh
                            </button>
                        </div>
                    </div>
                    
                    <!-- Filters -->
                    <div class="bg-light rounded-lg p-4 mb-6">
                        <div class="flex flex-wrap items-center gap-4">
                            <div class="flex items-center space-x-2">
                                <label class="text-sm font-medium text-gray-700">
                                    <i class="fas fa-search mr-1 text-primary"></i>Search:
                                </label>
                                <input 
                                    id="stockSearch" 
                                    type="text" 
                                    placeholder="Enter stock symbol..." 
                                    class="border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent w-40"
                                >
                            </div>
                            
                            <div class="flex items-center space-x-2">
                                <label class="text-sm font-medium text-gray-700">
                                    <i class="fas fa-smile mr-1 text-primary"></i>Sentiment:
                                </label>
                                <select id="sentimentFilter" class="border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="">All</option>
                                    <option value="positive">Positive</option>
                                    <option value="neutral">Neutral</option>
                                    <option value="negative">Negative</option>
                                </select>
                            </div>
                            
                            <div class="flex items-center space-x-2">
                                <label class="text-sm font-medium text-gray-700">
                                    <i class="fas fa-star mr-1 text-yellow-500"></i>VN30:
                                </label>
                                <select id="vn30Filter" class="border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="">All</option>
                                    <option value="true">VN30 Only</option>
                                    <option value="false">Non-VN30</option>
                                </select>
                            </div>
                            
                            <div class="flex items-center space-x-2">
                                <label class="text-sm font-medium text-gray-700">
                                    <i class="fas fa-sort mr-1 text-primary"></i>Sort by:
                                </label>
                                <select id="sortBy" class="border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="posts_count">Post Count</option>
                                    <option value="symbol">Symbol</option>
                                    <option value="last_updated">Date</option>
                                    <option value="sentiment">Sentiment</option>
                                </select>
                            </div>
                            
                            <div class="flex items-center space-x-2">
                                <select id="sortOrder" class="border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="desc">Descending</option>
                                    <option value="asc">Ascending</option>
                                </select>
                            </div>
                            
                            <button id="clearFilters" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors text-sm font-medium">
                                <i class="fas fa-times mr-1"></i>Clear
                            </button>
                        </div>
                    </div>
                    
                    <!-- Stocks Content -->
                    <div id="stocksContent">
                        <div id="stocksLoading" class="text-center py-12">
                            <i class="fas fa-spinner fa-spin text-3xl text-primary mb-4"></i>
                            <p class="text-gray-500 text-lg">Loading trending stocks...</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Global variables
        let currentStocksData = [];
        const chartInstances = {};
        
        // Get DOM elements
        const dashboardDays = document.getElementById("dashboardDays");
        const refreshStocksBtn = document.getElementById("refreshStocksBtn");
        const stocksLoading = document.getElementById("stocksLoading");
        const stocksContent = document.getElementById("stocksContent");

        // VNINDEX Chart functionality
        async function loadVNIndexChart(period = '1M') {
            const loadingEl = document.getElementById('vnindexLoading');
            const errorEl = document.getElementById('vnindexError');
            const canvas = document.getElementById('vnindexChart');

            try {
                loadingEl.classList.remove('hidden');
                errorEl.classList.add('hidden');

                // For standalone version, we'll create mock data
                // In the original app, this would be: const response = await fetch(`/vnindex-data?period=${period}`);
                const mockData = generateMockVNIndexData(period);
                
                // Update price display if elements exist
                const priceEl = document.getElementById('vnindexPrice');
                const changeEl = document.getElementById('vnindexChange');
                
                if (priceEl) {
                    priceEl.textContent = mockData.latest_price.toFixed(2);
                }
                
                if (changeEl) {
                    const isPositive = mockData.price_change >= 0;
                    changeEl.innerHTML = `
                        <span class="${isPositive ? 'text-green-600' : 'text-red-600'}">
                            <i class="fas fa-arrow-${isPositive ? 'up' : 'down'} mr-1"></i>
                            ${mockData.price_change.toFixed(2)} (${mockData.price_change_percent.toFixed(2)}%)
                        </span>
                    `;
                }

                // Destroy existing chart
                if (chartInstances['vnindex']) {
                    chartInstances['vnindex'].destroy();
                }

                // Create new chart with mock data
                const ctx = canvas.getContext('2d');
                chartInstances['vnindex'] = new Chart(ctx, mockData.chart_config);
                
                console.log(`VNINDEX chart loaded with ${mockData.data_points} data points for period ${period}`);

                loadingEl.classList.add('hidden');
            } catch (error) {
                console.error('Error loading VN-Index chart:', error);
                loadingEl.classList.add('hidden');
                errorEl.classList.remove('hidden');
                
                // Show detailed error message
                if (errorEl) {
                    errorEl.innerHTML = `
                        <div class="text-center py-4">
                            <i class="fas fa-exclamation-triangle text-orange-500 mb-2"></i>
                            <p class="text-sm text-gray-600">
                                Failed to load VNINDEX data: ${error.message}
                            </p>
                        </div>
                    `;
                }
            }
        }

        // Generate mock VN-Index data for standalone version
        function generateMockVNIndexData(period) {
            const periods = {
                '1M': 30,
                '3M': 90,
                '6M': 180,
                '1Y': 365
            };
            
            const days = periods[period] || 30;
            const data = [];
            const labels = [];
            let currentPrice = 1280 + Math.random() * 50; // Base VN-Index around 1280-1330
            
            for (let i = days; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                labels.push(date.toISOString().split('T')[0]);
                
                // Random walk with slight upward bias
                const change = (Math.random() - 0.48) * 20;
                currentPrice = Math.max(1200, Math.min(1400, currentPrice + change));
                data.push(parseFloat(currentPrice.toFixed(2)));
            }
            
            const startPrice = data[0];
            const endPrice = data[data.length - 1];
            const priceChange = endPrice - startPrice;
            const priceChangePercent = (priceChange / startPrice) * 100;
            
            return {
                success: true,
                latest_price: endPrice,
                price_change: priceChange,
                price_change_percent: priceChangePercent,
                data_points: data.length,
                chart_config: {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'VN-Index',
                            data: data,
                            borderColor: '#3B82F6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false
                            }
                        },
                        scales: {
                            x: {
                                display: true,
                                title: {
                                    display: true,
                                    text: 'Date'
                                }
                            },
                            y: {
                                display: true,
                                title: {
                                    display: true,
                                    text: 'Index Value'
                                }
                            }
                        },
                        interaction: {
                            mode: 'nearest',
                            axis: 'x',
                            intersect: false
                        }
                    }
                }
            };
        }

        // VNINDEX period button handlers
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('vnindex-period-btn')) {
                const period = e.target.dataset.period;
                
                // Update button states
                document.querySelectorAll('.vnindex-period-btn').forEach(btn => {
                    btn.classList.remove('bg-primary', 'text-white');
                    btn.classList.add('text-gray-600', 'hover:bg-gray-100');
                });
                
                e.target.classList.remove('text-gray-600', 'hover:bg-gray-100');
                e.target.classList.add('bg-primary', 'text-white');
                
                // Load chart with new period
                loadVNIndexChart(period);
            }
        });

        // Load recent stocks with modern styling
        async function loadRecentStocks() {
            try {
                const days = dashboardDays.value;
                
                stocksLoading.classList.remove("hidden");
                stocksContent.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-spinner fa-spin text-3xl text-primary mb-4"></i>
                        <p class="text-gray-500 text-lg">Loading trending stocks...</p>
                    </div>
                `;
                
                // For standalone version, we'll use mock data
                // In the original app, this would be: const response = await fetch(`/recent-stocks?days=${days}`);
                const result = { stocks: generateMockStocksData(days) };
                
                displayRecentStocks(result.stocks, days);
                
            } catch (error) {
                console.error("Error loading recent stocks:", error);
                stocksContent.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-exclamation-triangle text-3xl text-red-500 mb-4"></i>
                        <p class="text-gray-500 text-lg">Unable to load stock data</p>
                        <button onclick="loadRecentStocks()" class="mt-4 bg-primary hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors text-sm">
                            Try Again
                        </button>
                    </div>
                `;
            }
        }

        // Generate mock stocks data for standalone version
        function generateMockStocksData(days) {
            const mockStocks = [
                { symbol: 'VIC', name: 'Vingroup Joint Stock Company', exchange: 'HOSE', sentiment: 'positive', isvn30: true },
                { symbol: 'VHM', name: 'Vinhomes Joint Stock Company', exchange: 'HOSE', sentiment: 'neutral', isvn30: true },
                { symbol: 'HPG', name: 'Hoa Phat Group Joint Stock Company', exchange: 'HOSE', sentiment: 'positive', isvn30: true },
                { symbol: 'ACB', name: 'Asia Commercial Joint Stock Bank', exchange: 'HOSE', sentiment: 'negative', isvn30: true },
                { symbol: 'TCB', name: 'Techcombank', exchange: 'HOSE', sentiment: 'positive', isvn30: true },
                { symbol: 'FPT', name: 'FPT Corporation', exchange: 'HOSE', sentiment: 'positive', isvn30: true },
                { symbol: 'LDG', name: 'Lotte Holdings', exchange: 'HOSE', sentiment: 'neutral', isvn30: false },
                { symbol: 'MSN', name: 'Masan Group Corporation', exchange: 'HOSE', sentiment: 'positive', isvn30: true }
            ];

            return mockStocks.map((stock, index) => ({
                ...stock,
                posts_count: Math.floor(Math.random() * 20) + 1,
                summary: `Market analysis shows ${stock.sentiment} sentiment for ${stock.symbol} with increased trading volume and investor interest.`,
                last_updated: new Date(Date.now() - Math.random() * days * 24 * 60 * 60 * 1000).toISOString(),
                posts: Array.from({ length: Math.floor(Math.random() * 5) + 1 }, (_, i) => ({
                    url: `https://example.com/news/${stock.symbol.toLowerCase()}-${i + 1}`,
                    source_name: ['VnExpress', 'CafeF', 'VietStock', 'Investing'][Math.floor(Math.random() * 4)],
                    sentiment: stock.sentiment,
                    summary: `Analysis of ${stock.symbol} showing ${stock.sentiment} market indicators and trading signals.`,
                    stock_mention_summary: `${stock.symbol} demonstrates strong fundamentals with positive outlook for next quarter.`,
                    created_date: new Date(Date.now() - Math.random() * days * 24 * 60 * 60 * 1000).toISOString()
                }))
            }));
        }

        function displayRecentStocks(stocks, days) {
            if (!stocks || stocks.length === 0) {
                stocksContent.innerHTML = `
                    <div class="text-center py-16">
                        <i class="fas fa-chart-line text-6xl text-gray-300 mb-6"></i>
                        <h3 class="text-xl font-semibold text-gray-600 mb-2">No trending stocks found</h3>
                        <p class="text-gray-500 mb-6">No stocks were mentioned in the last ${days} days</p>
                        <button onclick="loadRecentStocks()" class="bg-primary hover:bg-blue-600 text-white px-6 py-3 rounded-lg transition-colors font-medium">
                            Refresh Data
                        </button>
                    </div>
                `;
                return;
            }

            const stocksHtml = stocks.map(stock => {
                const sentimentColor = getSentimentColor(stock.sentiment);
                
                const postsHtml = (stock.posts || []).map(post => `
                    <div class="bg-white border border-gray-100 rounded-lg p-4 mb-3 hover:shadow-md transition-shadow">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex-1">
                                <div class="flex items-center space-x-3 mb-2">
                                    <span class="text-xs font-medium text-primary bg-blue-50 px-2 py-1 rounded-full">${post.source_name}</span>
                                    <span class="px-2 py-1 rounded-full text-xs font-medium ${getSentimentColor(post.sentiment)}">
                                        ${post.sentiment}
                                    </span>
                                    <span class="text-xs text-gray-500">${formatDate(post.created_date)}</span>
                                </div>
                                <a href="${post.url}" target="_blank" class="text-sm text-gray-700 hover:text-primary line-clamp-2 leading-relaxed">
                                    ${post.summary}
                                </a>
                            </div>
                            <a href="${post.url}" target="_blank" class="ml-3 text-primary hover:text-blue-600 p-1">
                                <i class="fas fa-external-link-alt text-xs"></i>
                            </a>
                        </div>
                        ${post.stock_mention_summary ? `
                            <div class="text-xs text-gray-600 bg-gray-50 rounded-lg p-3 mt-2">
                                <span class="font-medium text-dark">About ${stock.symbol}:</span> ${post.stock_mention_summary}
                            </div>
                        ` : ''}
                    </div>
                `).join('');
                
                return `
                    <div class="bg-white border border-gray-100 rounded-xl p-6 hover:shadow-lg transition-all duration-200">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-gradient-to-r from-primary to-secondary rounded-xl flex items-center justify-center">
                                    <span class="text-white font-bold text-lg">${stock.symbol}</span>
                                </div>
                                <div>
                                    <h3 class="font-bold text-lg text-dark">${stock.symbol}</h3>
                                    ${stock.isvn30 ? '<span class="inline-flex items-center px-2 py-1 bg-yellow-100 text-yellow-800 text-xs font-medium rounded-full border border-yellow-200"><i class="fas fa-star mr-1"></i>VN30</span>' : ''}
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="flex items-center space-x-2 mb-1">
                                    <span class="px-3 py-1 rounded-full text-sm font-medium ${sentimentColor}">
                                        ${stock.sentiment}
                                    </span>
                                </div>
                                <p class="text-xs text-gray-500">${stock.posts_count} posts</p>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <p class="text-sm text-gray-600 leading-relaxed">
                                <strong>${stock.name}</strong> • ${stock.exchange}
                            </p>
                        </div>
                        
                        <div class="bg-blue-50 border border-blue-100 rounded-lg p-4 mb-4">
                            <h4 class="text-sm font-semibold text-blue-800 mb-2 flex items-center">
                                <i class="fas fa-chart-line mr-2"></i>Market Sentiment
                            </h4>
                            <p class="text-sm text-blue-700 leading-relaxed">
                                ${stock.summary || 'No analysis summary available'}
                            </p>
                        </div>
                        
                        <div>
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="text-sm font-semibold text-dark flex items-center">
                                    <i class="fas fa-newspaper mr-2 text-primary"></i>Recent Posts
                                </h4>
                                <span class="bg-gray-100 text-gray-700 px-2 py-1 rounded-full text-xs font-medium">
                                    ${stock.posts_count}
                                </span>
                            </div>
                            <div class="max-h-80 overflow-y-auto space-y-2">
                                ${postsHtml || '<p class="text-sm text-gray-500 italic text-center py-4">No posts available</p>'}
                            </div>
                        </div>
                        
                        <div class="pt-4 border-t border-gray-100 mt-4">
                            <div class="flex items-center justify-between text-xs text-gray-500">
                                <span>Last updated: ${formatDate(stock.last_updated)}</span>
                                <div class="flex items-center space-x-4">
                                    <button class="load-company-info-btn text-primary hover:text-blue-600 font-medium" data-symbol="${stock.symbol}">
                                        <i class="fas fa-info-circle mr-1"></i>Company Info
                                    </button>
                                    <button class="load-company-finance-btn text-green-600 hover:text-green-700 font-medium" data-symbol="${stock.symbol}">
                                        <i class="fas fa-calculator mr-1"></i>Finance Data
                                    </button>
                                    <button class="chart-period-btn text-primary hover:text-blue-600 font-medium" data-period="1m" data-symbol="${stock.symbol}">
                                        <i class="fas fa-chart-area mr-1"></i>Price Chart
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            stocksContent.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    ${stocksHtml}
                </div>
                <div class="text-center mt-8 p-4 bg-gray-50 rounded-lg">
                    <p class="text-sm text-gray-600">
                        Showing <span class="font-semibold text-dark">${stocks.length}</span> trending stocks from the last <span class="font-semibold text-dark">${days}</span> days
                    </p>
                </div>
            `;

            // Store data for filtering
            currentStocksData = stocks;
        }

        // Utility functions
        function getSentimentColor(sentiment) {
            switch (sentiment?.toLowerCase()) {
                case 'positive': return 'bg-green-100 text-green-800 border-green-200';
                case 'negative': return 'bg-red-100 text-red-800 border-red-200';
                case 'neutral': return 'bg-gray-100 text-gray-800 border-gray-200';
                default: return 'bg-gray-100 text-gray-800 border-gray-200';
            }
        }

        function formatDate(dateString) {
            try {
                return new Date(dateString).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
            } catch (e) {
                return 'N/A';
            }
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const bgColor = type === 'error' ? 'bg-red-500' : type === 'success' ? 'bg-green-500' : 'bg-blue-500';
            toast.className = `fixed top-4 right-4 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50 transform transition-transform duration-300 translate-x-full`;
            toast.textContent = message;

            document.body.appendChild(toast);

            // Slide in
            setTimeout(() => {
                toast.classList.remove('translate-x-full');
            }, 100);

            // Slide out and remove
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }

        // Event listeners setup
        function setupEventListeners() {
            document.getElementById('stockSearch')?.addEventListener('input', applyFilters);
            document.getElementById('sentimentFilter')?.addEventListener('change', applyFilters);
            document.getElementById('vn30Filter')?.addEventListener('change', applyFilters);
            document.getElementById('sortBy')?.addEventListener('change', applyFilters);
            document.getElementById('sortOrder')?.addEventListener('change', applyFilters);
            document.getElementById('clearFilters')?.addEventListener('click', clearFilters);
        }

        function applyFilters() {
            // Filter implementation would go here
            // For this standalone version, just reload the stocks
            if (currentStocksData.length > 0) {
                displayRecentStocks(currentStocksData, dashboardDays.value);
            }
        }

        function clearFilters() {
            document.getElementById('stockSearch').value = '';
            document.getElementById('sentimentFilter').value = '';
            document.getElementById('vn30Filter').value = '';
            document.getElementById('sortBy').value = 'posts_count';
            document.getElementById('sortOrder').value = 'desc';
            applyFilters();
        }

        // Mock functions for button clicks (these would connect to real APIs in the full application)
        function loadCompanyInfo(symbol) {
            showToast(`Loading company information for ${symbol}...`, 'info');
            setTimeout(() => {
                showToast(`Company info for ${symbol} would be displayed here in the full application`, 'info');
            }, 1000);
        }

        function loadCompanyFinance(symbol) {
            showToast(`Loading financial data for ${symbol}...`, 'info');
            setTimeout(() => {
                showToast(`Financial data for ${symbol} would be displayed here in the full application`, 'info');
            }, 1000);
        }

        function showPriceChart(symbol) {
            showToast(`Loading price chart for ${symbol}...`, 'info');
            setTimeout(() => {
                showToast(`Price chart for ${symbol} would be displayed here in the full application`, 'info');
            }, 1000);
        }

        // Event delegation for dynamically created buttons
        document.addEventListener('click', function(e) {
            if (e.target.closest('.load-company-info-btn')) {
                e.preventDefault();
                const btn = e.target.closest('.load-company-info-btn');
                const symbol = btn.dataset.symbol;
                loadCompanyInfo(symbol);
            }
            
            if (e.target.closest('.load-company-finance-btn')) {
                e.preventDefault();
                const btn = e.target.closest('.load-company-finance-btn');
                const symbol = btn.dataset.symbol;
                loadCompanyFinance(symbol);
            }
            
            if (e.target.closest('.chart-period-btn')) {
                e.preventDefault();
                const btn = e.target.closest('.chart-period-btn');
                const symbol = btn.dataset.symbol;
                showPriceChart(symbol);
            }
        });

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadRecentStocks();
            loadVNIndexChart();
            setupEventListeners();
            
            // Set up refresh button
            refreshStocksBtn.addEventListener("click", loadRecentStocks);
            dashboardDays.addEventListener("change", loadRecentStocks);
        });
    </script>
</body>
</html>